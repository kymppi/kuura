---
import LoginPage from '../components/LoginPage';
import ClientExperienceLayout from '../layouts/ClientExperienceLayout.astro';

const url = new URL(Astro.request.url);
const returnTo = url.searchParams.get('return_to') ?? '/home';
---

<ClientExperienceLayout>
  <LoginPage client:load returnTo={returnTo} />
</ClientExperienceLayout>

<script>
  window.addEventListener('DOMContentLoaded', async () => {
    const params = new URLSearchParams(window.location.search);
    const returnTo = params.get('return_to') || '/home';

    try {
      const response = await fetch('/v1/me', {
        credentials: 'include',
      });

      if (response.status === 200) {
        window.location.href = returnTo;
      }
    } catch (err) {
      console.error('Auth check failed:', err);
    }
  });
</script>
